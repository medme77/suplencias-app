<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Suplencias M√©dicas</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const SUPABASE_URL = 'https://gicgkdowyexgxzremnpf.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpY2drZG93eWV4Z3h6cmVtbnBmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMDA2NTEsImV4cCI6MjA3Nzg3NjY1MX0.PNB97KW8rqjKU3SK8sN3RWFqKRMFSfk1q6hIlr0qkF4';

        const supabase = {
          async insert(table, data) {
            try {
              const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
                method: 'POST',
                headers: {'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json', 'Prefer': 'return=representation'},
                body: JSON.stringify(data)
              });
              if (!response.ok) throw new Error('Error al insertar');
              return await response.json();
            } catch (e) {
              console.error('Error insert:', e);
              throw e;
            }
          },
          async select(table) {
            try {
              const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?order=timestamp.desc`, {
                headers: {'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`}
              });
              if (!response.ok) throw new Error('Error al cargar');
              return await response.json();
            } catch (e) {
              console.error('Error select:', e);
              return [];
            }
          },
          async delete(table, id) {
            try {
              const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?id=eq.${id}`, {
                method: 'DELETE',
                headers: {'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`}
              });
              return response.ok;
            } catch (e) {
              console.error('Error delete:', e);
              return false;
            }
          }
        };

        const TURNOS = ['Matutino', 'Vespertino', 'Nocturno', 'Fin de Semana'];

        function App() {
          const [view, setView] = useState('registro');
          const [suplencias, setSuplencias] = useState([]);
          const [misSuplencias, setMisSuplencias] = useState([]);
          const [loading, setLoading] = useState(false);
          
          const [nombreMedico, setNombreMedico] = useState('');
          const [mostrarConfig, setMostrarConfig] = useState(false);
          const [perfilOk, setPerfilOk] = useState(false);
          
          const [esAdmin, setEsAdmin] = useState(false);
          const [pin, setPin] = useState('');
          const [pinGuardado, setPinGuardado] = useState('');
          const [pinPrompt, setPinPrompt] = useState(false);
          const [pinInput, setPinInput] = useState('');
          
          const [fechaSolicitud, setFechaSolicitud] = useState('');
          const [fechaSuplencia, setFechaSuplencia] = useState('');
          const [turnoTitular, setTurnoTitular] = useState('Matutino');
          const [medicoSuplente, setMedicoSuplente] = useState('');
          const [turnoSuplente, setTurnoSuplente] = useState('Matutino');
          const [notas, setNotas] = useState('');
          
          const [filtroMes, setFiltroMes] = useState('');
          const [filtroMedico, setFiltroMedico] = useState('');
          const [filtroTurno, setFiltroTurno] = useState('');

          useEffect(() => {
            const datos = {
              nombre: localStorage.getItem('nombreMedicoSup') || '',
              esAdmin: localStorage.getItem('esAdminSup') === 'true',
              pin: localStorage.getItem('pinAdminSup') || ''
            };
            
            if (datos.nombre) {
              setNombreMedico(datos.nombre);
              setEsAdmin(datos.esAdmin);
              setPinGuardado(datos.pin);
              setPerfilOk(true);
              cargarMisSuplencias(datos.nombre);
            } else {
              setMostrarConfig(true);
            }

            const hoy = new Date().toISOString().split('T')[0];
            setFechaSolicitud(hoy);
            setFechaSuplencia(hoy);
          }, []);

          const guardarPerfil = () => {
            if (!nombreMedico.trim()) return alert('‚ö†Ô∏è Ingresa tu nombre');
            if (esAdmin && !pin) return alert('‚ö†Ô∏è Configura un PIN');
            
            localStorage.setItem('nombreMedicoSup', nombreMedico);
            localStorage.setItem('esAdminSup', esAdmin.toString());
            if (esAdmin) {
              localStorage.setItem('pinAdminSup', pin);
              setPinGuardado(pin);
            }
            setPerfilOk(true);
            setMostrarConfig(false);
            cargarMisSuplencias(nombreMedico);
            alert('‚úÖ Perfil guardado');
          };

          const cargarMisSuplencias = async (nombre) => {
            try {
              const todas = await supabase.select('suplencias');
              setMisSuplencias(todas.filter(s => s.medico_titular === nombre || s.medico_suplente === nombre));
            } catch (e) {
              console.error('Error cargar mis suplencias:', e);
              setMisSuplencias([]);
            }
          };

          const cargarTodasSuplencias = async () => {
            setLoading(true);
            try {
              const todas = await supabase.select('suplencias');
              console.log('Suplencias cargadas:', todas);
              setSuplencias(todas || []);
            } catch (e) {
              console.error('Error al cargar todas:', e);
              alert('‚ö†Ô∏è Error al cargar suplencias. Verifica tu conexi√≥n.');
              setSuplencias([]);
            } finally {
              setLoading(false);
            }
          };

          const registrarSuplencia = async () => {
            if (!perfilOk) {
              setMostrarConfig(true);
              return alert('‚ö†Ô∏è Configura tu perfil primero');
            }

            if (!fechaSolicitud || !fechaSuplencia || !medicoSuplente.trim()) {
              return alert('‚ö†Ô∏è Completa todos los campos obligatorios');
            }

            const suplencia = {
              id: Date.now(),
              fecha_solicitud: fechaSolicitud,
              fecha_suplencia: fechaSuplencia,
              medico_titular: nombreMedico,
              turno_titular: turnoTitular,
              medico_suplente: medicoSuplente.trim(),
              turno_suplente: turnoSuplente,
              estado: 'Activa',
              notas: notas.trim() || null,
              timestamp: Date.now()
            };

            try {
              await supabase.insert('suplencias', suplencia);
              alert('‚úÖ Suplencia registrada correctamente');
              
              setMedicoSuplente('');
              setNotas('');
              const hoy = new Date().toISOString().split('T')[0];
              setFechaSolicitud(hoy);
              setFechaSuplencia(hoy);
              
              cargarMisSuplencias(nombreMedico);
            } catch (e) {
              alert('‚ö†Ô∏è Error al registrar suplencia');
            }
          };

          const eliminarSuplencia = async (id) => {
            if (!confirm('¬øEliminar esta suplencia?')) return;
            
            try {
              const ok = await supabase.delete('suplencias', id);
              if (ok) {
                alert('‚úÖ Suplencia eliminada');
                cargarTodasSuplencias();
              } else {
                alert('‚ö†Ô∏è Error al eliminar');
              }
            } catch (e) {
              alert('‚ö†Ô∏è Error al eliminar');
            }
          };

          const exportarExcel = (lista = null) => {
            const listaExportar = lista || filtrarSuplencias();
            if (!listaExportar.length) return alert('‚ö†Ô∏è No hay suplencias para exportar');

            let csv = 'Fecha Solicitud,Fecha Suplencia,Titular,Turno Titular,Suplente,Turno Suplente,Estado,Notas\n';
            listaExportar.forEach(s => {
              csv += `"${s.fecha_solicitud}","${s.fecha_suplencia}","${s.medico_titular}","${s.turno_titular}","${s.medico_suplente}","${s.turno_suplente}","${s.estado}","${s.notas||''}"\n`;
            });

            const blob = new Blob([csv], {type: 'text/csv;charset=utf-8'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `suplencias_${Date.now()}.csv`;
            link.click();
            
            alert('‚úÖ Archivo Excel descargado');
          };

          const generarReporte = () => {
            const lista = filtrarSuplencias();
            if (!lista.length) return alert('‚ö†Ô∏è No hay datos para el reporte');

            const medicosStats = {};
            const turnosStats = {};

            lista.forEach(s => {
              if (!medicosStats[s.medico_titular]) {
                medicosStats[s.medico_titular] = {solicitadas: 0, cubiertas: 0};
              }
              if (!medicosStats[s.medico_suplente]) {
                medicosStats[s.medico_suplente] = {solicitadas: 0, cubiertas: 0};
              }
              
              medicosStats[s.medico_titular].solicitadas++;
              medicosStats[s.medico_suplente].cubiertas++;

              turnosStats[s.turno_titular] = (turnosStats[s.turno_titular] || 0) + 1;
            });

            let reporte = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            reporte += '    REPORTE DE SUPLENCIAS M√âDICAS\n';
            reporte += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            reporte += `Total de suplencias: ${lista.length}\n`;
            reporte += `M√©dicos involucrados: ${Object.keys(medicosStats).length}\n\n`;
            
            reporte += '--- ESTAD√çSTICAS POR M√âDICO ---\n\n';
            Object.entries(medicosStats).sort((a,b) => (b[1].solicitadas + b[1].cubiertas) - (a[1].solicitadas + a[1].cubiertas)).forEach(([medico, stats]) => {
              reporte += `${medico}:\n`;
              reporte += `  ‚Ä¢ Suplencias solicitadas: ${stats.solicitadas}\n`;
              reporte += `  ‚Ä¢ Suplencias cubiertas: ${stats.cubiertas}\n`;
              reporte += `  ‚Ä¢ Total: ${stats.solicitadas + stats.cubiertas}\n\n`;
            });

            reporte += '--- ESTAD√çSTICAS POR TURNO ---\n\n';
            Object.entries(turnosStats).forEach(([turno, count]) => {
              reporte += `${turno}: ${count} suplencias\n`;
            });

            const blob = new Blob([reporte], {type: 'text/plain;charset=utf-8'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `reporte_suplencias_${Date.now()}.txt`;
            link.click();
            
            alert('‚úÖ Reporte descargado');
          };

          const filtrarSuplencias = () => {
            let lista = view === 'admin' ? suplencias : misSuplencias;

            if (filtroMes) {
              lista = lista.filter(s => s.fecha_suplencia.startsWith(filtroMes));
            }
            if (filtroMedico) {
              lista = lista.filter(s => 
                s.medico_titular.toLowerCase().includes(filtroMedico.toLowerCase()) ||
                s.medico_suplente.toLowerCase().includes(filtroMedico.toLowerCase())
              );
            }
            if (filtroTurno) {
              lista = lista.filter(s => s.turno_titular === filtroTurno || s.turno_suplente === filtroTurno);
            }

            return lista;
          };

          const calcularEstadisticas = (lista) => {
            const medicosStats = {};
            const turnosStats = {};

            lista.forEach(s => {
              if (!medicosStats[s.medico_titular]) {
                medicosStats[s.medico_titular] = {solicitadas: 0, cubiertas: 0};
              }
              if (!medicosStats[s.medico_suplente]) {
                medicosStats[s.medico_suplente] = {solicitadas: 0, cubiertas: 0};
              }
              
              medicosStats[s.medico_titular].solicitadas++;
              medicosStats[s.medico_suplente].cubiertas++;

              turnosStats[s.turno_titular] = (turnosStats[s.turno_titular] || 0) + 1;
            });

            return { medicosStats, turnosStats };
          };

          if (pinPrompt) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 to-purple-100 p-4 flex items-center justify-center">
                <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
                  <h2 className="text-2xl font-bold text-center mb-4">üîí PIN Administrador</h2>
                  <input
                    type="password"
                    value={pinInput}
                    onChange={(e) => setPinInput(e.target.value)}
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    className="w-full p-4 text-center text-2xl border-2 rounded-lg mb-4"
                    maxLength="4"
                    autoFocus
                    onKeyPress={(e) => {
                      if (e.key === 'Enter') {
                        if (pinInput === pinGuardado) {
                          setView('admin');
                          cargarTodasSuplencias();
                          setPinPrompt(false);
                          setPinInput('');
                        } else {
                          alert('‚ùå PIN incorrecto');
                          setPinInput('');
                        }
                      }
                    }}
                  />
                  <button
                    onClick={() => {
                      if (pinInput === pinGuardado) {
                        setView('admin');
                        cargarTodasSuplencias();
                        setPinPrompt(false);
                        setPinInput('');
                      } else {
                        alert('‚ùå PIN incorrecto');
                        setPinInput('');
                      }
                    }}
                    className="w-full bg-purple-500 text-white py-3 rounded-lg font-bold mb-2 hover:bg-purple-600"
                  >
                    Verificar
                  </button>
                  <button
                    onClick={() => {setPinPrompt(false); setPinInput('');}}
                    className="w-full bg-gray-200 py-2 rounded-lg hover:bg-gray-300"
                  >
                    Cancelar
                  </button>
                </div>
              </div>
            );
          }

          if (mostrarConfig) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 to-purple-100 p-4 flex items-center justify-center">
                <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
                  <h2 className="text-2xl font-bold text-center mb-6">üë®‚Äç‚öïÔ∏è Configurar Perfil</h2>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-bold mb-2">Nombre Completo *</label>
                      <input 
                        type="text" 
                        value={nombreMedico} 
                        onChange={(e) => setNombreMedico(e.target.value)} 
                        placeholder="Dr. Juan P√©rez" 
                        className="w-full p-3 border-2 rounded-lg" 
                      />
                    </div>
                    
                    <div className="border-t pt-4">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input 
                          type="checkbox" 
                          checked={esAdmin} 
                          onChange={(e) => setEsAdmin(e.target.checked)} 
                          className="w-5 h-5" 
                        />
                        <span className="font-bold">Soy administrador üõ°Ô∏è</span>
                      </label>
                    </div>
                    
                    {esAdmin && (
                      <div className="bg-purple-50 border-2 border-purple-300 rounded-lg p-4">
                        <label className="block text-sm font-bold mb-2">PIN (4 d√≠gitos) *</label>
                        <input 
                          type="password" 
                          value={pin} 
                          onChange={(e) => setPin(e.target.value.replace(/\D/g, '').slice(0, 4))} 
                          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                          maxLength="4" 
                          className="w-full p-3 text-center text-xl border-2 rounded-lg" 
                        />
                      </div>
                    )}
                    
                    <button 
                      onClick={guardarPerfil} 
                      className="w-full bg-purple-500 text-white py-3 rounded-lg font-bold hover:bg-purple-600"
                    >
                      Guardar
                    </button>
                    
                    {perfilOk && (
                      <button 
                        onClick={() => setMostrarConfig(false)} 
                        className="w-full bg-gray-200 py-2 rounded-lg hover:bg-gray-300"
                      >
                        Cancelar
                      </button>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 to-purple-100 p-4">
              <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                  <div className="flex justify-between items-start">
                    <div>
                      <h1 className="text-2xl font-bold text-purple-900">üè• Gesti√≥n de Suplencias</h1>
                      <p className="text-gray-600">
                        Dr(a). {nombreMedico}
                        {esAdmin && <span className="ml-2 bg-purple-400 text-white px-2 py-0.5 rounded text-xs font-bold">ADMIN</span>}
                      </p>
                      <p className="text-xs text-green-600 font-bold">üîó Conectado a Supabase</p>
                    </div>
                    <button onClick={() => setMostrarConfig(true)} className="bg-gray-100 p-3 rounded-lg hover:bg-gray-200">‚öôÔ∏è</button>
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-lg p-4 mb-6">
                  <div className={`grid ${esAdmin ? 'grid-cols-4' : 'grid-cols-3'} gap-3`}>
                    <button
                      onClick={() => setView('registro')}
                      className={`p-4 rounded-lg font-bold transition ${view === 'registro' ? 'bg-purple-500 text-white' : 'bg-gray-100 hover:bg-gray-200'}`}
                    >
                      ‚ûï Nueva
                    </button>
                    <button
                      onClick={() => setView('mis-suplencias')}
                      className={`p-4 rounded-lg font-bold transition ${view === 'mis-suplencias' ? 'bg-purple-500 text-white' : 'bg-gray-100 hover:bg-gray-200'}`}
                    >
                      üìã Mis Suplencias
                    </button>
                    <button
                      onClick={() => setView('estadisticas')}
                      className={`p-4 rounded-lg font-bold transition ${view === 'estadisticas' ? 'bg-purple-500 text-white' : 'bg-gray-100 hover:bg-gray-200'}`}
                    >
                      üìä Estad√≠sticas
                    </button>
                    {esAdmin && (
                      <button
                        onClick={() => setPinPrompt(true)}
                        className={`p-4 rounded-lg font-bold transition ${view === 'admin' ? 'bg-yellow-500 text-white' : 'bg-yellow-100 hover:bg-yellow-200'}`}
                      >
                        üõ°Ô∏è Admin
                      </button>
                    )}
                  </div>
                </div>

                {view === 'registro' && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">‚ûï Registrar Nueva Suplencia</h2>
                    
                    <div className="grid md:grid-cols-2 gap-6">
                      <div>
                        <h3 className="font-bold text-lg mb-4 text-purple-700">üìÖ Fechas</h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold mb-2">Fecha de Solicitud *</label>
                            <input
                              type="date"
                              value={fechaSolicitud}
                              onChange={(e) => setFechaSolicitud(e.target.value)}
                              className="w-full p-3 border-2 rounded-lg"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-bold mb-2">Fecha de la Suplencia *</label>
                            <input
                              type="date"
                              value={fechaSuplencia}
                              onChange={(e) => setFechaSuplencia(e.target.value)}
                              className="w-full p-3 border-2 rounded-lg"
                            />
                          </div>
                        </div>
                      </div>

                      <div>
                        <h3 className="font-bold text-lg mb-4 text-purple-700">üë®‚Äç‚öïÔ∏è M√©dico Titular</h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold mb-2">Nombre (T√∫)</label>
                            <input
                              type="text"
                              value={nombreMedico}
                              disabled
                              className="w-full p-3 border-2 rounded-lg bg-gray-100"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-bold mb-2">Turno del Titular *</label>
                            <select
                              value={turnoTitular}
                              onChange={(e) => setTurnoTitular(e.target.value)}
                              className="w-full p-3 border-2 rounded-lg"
                            >
                              {TURNOS.map(t => <option key={t} value={t}>{t}</option>)}
                            </select>
                          </div>
                        </div>
                      </div>

                      <div>
                        <h3 className="font-bold text-lg mb-4 text-green-700">üë§ M√©dico Suplente</h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold mb-2">Nombre del Suplente *</label>
                            <input
                              type="text"
                              value={medicoSuplente}
                              onChange={(e) => setMedicoSuplente(e.target.value)}
                              placeholder="Dr. Mar√≠a Garc√≠a"
                              className="w-full p-3 border-2 rounded-lg"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-bold mb-2">Turno del Suplente *</label>
                            <select
                              value={turnoSuplente}
                              onChange={(e) => setTurnoSuplente(e.target.value)}
                              className="w-full p-3 border-2 rounded-lg"
                            >
                              {TURNOS.map(t => <option key={t} value={t}>{t}</option>)}
                            </select>
                          </div>
                        </div>
                      </div>

                      <div>
                        <h3 className="font-bold text-lg mb-4 text-gray-700">üìù Notas (opcional)</h3>
                        <textarea
                          value={notas}
                          onChange={(e) => setNotas(e.target.value)}
                          placeholder="Informaci√≥n adicional..."
                          className="w-full p-3 border-2 rounded-lg h-32"
                        />
                      </div>
                    </div>

                    <button
                      onClick={registrarSuplencia}
                      className="w-full mt-6 bg-purple-500 text-white py-4 rounded-lg font-bold text-lg hover:bg-purple-600 transition"
                    >
                      ‚úÖ Registrar Suplencia
                    </button>
                  </div>
                )}

                {view === 'mis-suplencias' && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-4">üìã Mis Suplencias</h2>
                    
                    {misSuplencias.length === 0 ? (
                      <div className="text-center py-12 text-gray-500">
                        <p className="text-lg">No tienes suplencias registradas</p>
                        <button
                          onClick={() => setView('registro')}
                          className="mt-4 bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600"
                        >
                          Registrar Primera Suplencia
                        </button>
                      </div>
                    ) : (
                      <div className="space-y-3">
                        {misSuplencias.map(s => (
                          <div key={s.id} className="border-2 rounded-lg p-4 hover:border-purple-300 transition">
                            <div className="flex justify-between items-start mb-2">
                              <div>
                                <span className={`text-xs px-2 py-1 rounded font-bold ${
                                  s.medico_titular === nombreMedico ? 'bg-purple-100 text-purple-700' : 'bg-green-100 text-green-700'
                                }`}>
                                  {s.medico_titular === nombreMedico ? 'Solicitada por ti' : 'Cubriendo'}
                                </span>
                                <h3 className="font-bold mt-2 text-lg">
                                  {s.medico_titular === nombreMedico ? `Suplente: ${s.medico_suplente}` : `Titular: ${s.medico_titular}`}
                                </h3>
                              </div>
                              <span className="bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-bold">
                                {s.estado}
                              </span>
                            </div>
                            <div className="text-sm text-gray-600 space-y-1">
                              <p>üìÖ Fecha suplencia: <strong
>{new Date(s.fecha_suplencia).toLocaleDateString('es-MX', {year: 'numeric', month: 'long', day: 'numeric'})}</strong></p>
                              <p>üïê Turno titular: <strong>{s.turno_titular}</strong> ‚Ä¢ Turno suplente: <strong>{s.turno_suplente}</strong></p>
                              {s.notas && <p className="bg-gray-50 p-2 rounded mt-2">üìù {s.notas}</p>}
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                )}

                {view === 'estadisticas' && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-4">üìä Mis Estad√≠sticas</h2>
                    
                    {misSuplencias.length === 0 ? (
                      <div className="text-center py-12 text-gray-500">
                        <p>No hay datos para mostrar</p>
                      </div>
                    ) : (
                      <div className="space-y-6">
                        <div className="grid grid-cols-2 gap-4">
                          <div className="bg-purple-50 rounded-lg p-4 border-2 border-purple-200">
                            <p className="text-sm text-gray-600 mb-1">Suplencias Solicitadas</p>
                            <p className="text-4xl font-bold text-purple-600">
                              {misSuplencias.filter(s => s.medico_titular === nombreMedico).length}
                            </p>
                          </div>
                          <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                            <p className="text-sm text-gray-600 mb-1">Suplencias Cubiertas</p>
                            <p className="text-4xl font-bold text-green-600">
                              {misSuplencias.filter(s => s.medico_suplente === nombreMedico).length}
                            </p>
                          </div>
                        </div>

                        <div className="border-t pt-4">
                          <h3 className="font-bold mb-3 text-lg">Detalle de mis suplencias solicitadas:</h3>
                          {misSuplencias.filter(s => s.medico_titular === nombreMedico).length === 0 ? (
                            <p className="text-gray-500">No has solicitado suplencias</p>
                          ) : (
                            <div className="space-y-2">
                              {misSuplencias.filter(s => s.medico_titular === nombreMedico).map(s => (
                                <div key={s.id} className="bg-purple-50 rounded p-3 text-sm border border-purple-200">
                                  <p className="font-bold">{new Date(s.fecha_suplencia).toLocaleDateString('es-MX')} ‚Ä¢ {s.turno_titular}</p>
                                  <p className="text-gray-600">Cubierta por: {s.medico_suplente}</p>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>

                        <div className="border-t pt-4">
                          <h3 className="font-bold mb-3 text-lg">Detalle de suplencias que he cubierto:</h3>
                          {misSuplencias.filter(s => s.medico_suplente === nombreMedico).length === 0 ? (
                            <p className="text-gray-500">No has cubierto suplencias</p>
                          ) : (
                            <div className="space-y-2">
                              {misSuplencias.filter(s => s.medico_suplente === nombreMedico).map(s => (
                                <div key={s.id} className="bg-green-50 rounded p-3 text-sm border border-green-200">
                                  <p className="font-bold">{new Date(s.fecha_suplencia).toLocaleDateString('es-MX')} ‚Ä¢ {s.turno_suplente}</p>
                                  <p className="text-gray-600">Para: {s.medico_titular}</p>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {view === 'admin' && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <div className="flex justify-between items-center mb-6">
                      <h2 className="text-2xl font-bold">üõ°Ô∏è Panel de Administraci√≥n</h2>
                      <button 
                        onClick={cargarTodasSuplencias} 
                        disabled={loading}
                        className="bg-purple-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-purple-600 disabled:bg-gray-400 transition"
                      >
                        {loading ? '‚è≥ Cargando...' : 'üîÑ Actualizar'}
                      </button>
                    </div>

                    <div className="bg-gray-50 rounded-lg p-4 mb-6">
                      <h3 className="font-bold mb-3">üîç Filtros</h3>
                      <div className="grid md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-sm font-bold mb-2">Mes</label>
                          <input
                            type="month"
                            value={filtroMes}
                            onChange={(e) => setFiltroMes(e.target.value)}
                            className="w-full p-2 border-2 rounded-lg"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-bold mb-2">M√©dico</label>
                          <input
                            type="text"
                            value={filtroMedico}
                            onChange={(e) => setFiltroMedico(e.target.value)}
                            placeholder="Buscar por nombre..."
                            className="w-full p-2 border-2 rounded-lg"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-bold mb-2">Turno</label>
                          <select
                            value={filtroTurno}
                            onChange={(e) => setFiltroTurno(e.target.value)}
                            className="w-full p-2 border-2 rounded-lg"
                          >
                            <option value="">Todos</option>
                            {TURNOS.map(t => <option key={t} value={t}>{t}</option>)}
                          </select>
                        </div>
                      </div>
                      <button
                        onClick={() => {setFiltroMes(''); setFiltroMedico(''); setFiltroTurno('');}}
                        className="mt-3 text-sm text-purple-600 font-bold hover:text-purple-800"
                      >
                        Limpiar filtros
                      </button>
                    </div>

                    {loading ? (
                      <div className="text-center py-12">
                        <div className="text-4xl mb-4">‚è≥</div>
                        <p className="text-gray-600">Cargando suplencias...</p>
                      </div>
                    ) : suplencias.length === 0 ? (
                      <div className="text-center py-12 text-gray-500">
                        <div className="text-4xl mb-4">üìã</div>
                        <p className="text-lg">No hay suplencias registradas en el sistema</p>
                      </div>
                    ) : (
                      <>
                        <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 mb-6 border-2 border-purple-200">
                          <h3 className="font-bold text-lg mb-4">üìà Estad√≠sticas Generales</h3>
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                            <div className="bg-white rounded-lg p-3">
                              <p className="text-xs text-gray-600">Total Suplencias</p>
                              <p className="text-3xl font-bold text-purple-600">{filtrarSuplencias().length}</p>
                            </div>
                            <div className="bg-white rounded-lg p-3">
                              <p className="text-xs text-gray-600">M√©dicos Involucrados</p>
                              <p className="text-3xl font-bold text-blue-600">
                                {new Set([...filtrarSuplencias().map(s => s.medico_titular), ...filtrarSuplencias().map(s => s.medico_suplente)]).size}
                              </p>
                            </div>
                            <div className="bg-white rounded-lg p-3">
                              <p className="text-xs text-gray-600">Este Mes</p>
                              <p className="text-3xl font-bold text-green-600">
                                {filtrarSuplencias().filter(s => s.fecha_suplencia.startsWith(new Date().toISOString().slice(0,7))).length}
                              </p>
                            </div>
                            <div className="bg-white rounded-lg p-3">
                              <p className="text-xs text-gray-600">Activas</p>
                              <p className="text-3xl font-bold text-orange-600">
                                {filtrarSuplencias().filter(s => s.estado === 'Activa').length}
                              </p>
                            </div>
                          </div>

                          <div className="flex gap-3">
                            <button
                              onClick={() => exportarExcel()}
                              className="flex-1 bg-green-500 text-white py-3 rounded-lg font-bold hover:bg-green-600 transition"
                            >
                              üì• Exportar Excel
                            </button>
                            <button
                              onClick={generarReporte}
                              className="flex-1 bg-blue-500 text-white py-3 rounded-lg font-bold hover:bg-blue-600 transition"
                            >
                              üìä Generar Reporte TXT
                            </button>
                          </div>
                        </div>

                        {filtrarSuplencias().length > 0 && (
                          <div className="mb-6">
                            <h3 className="font-bold text-lg mb-3">üèÜ Top M√©dicos</h3>
                            <div className="space-y-2">
                              {Object.entries(calcularEstadisticas(filtrarSuplencias()).medicosStats)
                                .sort((a,b) => (b[1].solicitadas + b[1].cubiertas) - (a[1].solicitadas + a[1].cubiertas))
                                .slice(0, 10)
                                .map(([medico, stats]) => (
                                  <div key={medico} className="bg-gray-50 rounded-lg p-3 flex justify-between items-center hover:bg-gray-100 transition">
                                    <span className="font-bold">{medico}</span>
                                    <div className="flex gap-4 text-sm">
                                      <span className="text-purple-600">Solicitadas: <strong>{stats.solicitadas}</strong></span>
                                      <span className="text-green-600">Cubiertas: <strong>{stats.cubiertas}</strong></span>
                                      <span className="text-blue-600">Total: <strong>{stats.solicitadas + stats.cubiertas}</strong></span>
                                    </div>
                                  </div>
                                ))}
                            </div>
                          </div>
                        )}

                        <h3 className="font-bold text-lg mb-3">üìã Todas las Suplencias ({filtrarSuplencias().length})</h3>
                        <div className="space-y-3 max-h-96 overflow-y-auto">
                          {filtrarSuplencias().map(s => (
                            <div key={s.id} className="border-2 rounded-lg p-4 hover:border-purple-300 transition">
                              <div className="flex justify-between items-start mb-2">
                                <div>
                                  <span className="bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-bold mr-2">
                                    {new Date(s.fecha_suplencia).toLocaleDateString('es-MX')}
                                  </span>
                                  <span className="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold">
                                    {s.estado}
                                  </span>
                                </div>
                                <button
                                  onClick={() => eliminarSuplencia(s.id)}
                                  className="text-red-500 hover:bg-red-50 p-2 rounded transition"
                                  title="Eliminar suplencia"
                                >
                                  üóëÔ∏è
                                </button>
                              </div>
                              <div className="grid md:grid-cols-2 gap-4 text-sm">
                                <div>
                                  <p className="font-bold text-purple-700">üë®‚Äç‚öïÔ∏è Titular:</p>
                                  <p className="font-semibold">{s.medico_titular}</p>
                                  <p className="text-gray-600">Turno: {s.turno_titular}</p>
                                </div>
                                <div>
                                  <p className="font-bold text-green-700">üë§ Suplente:</p>
                                  <p className="font-semibold">{s.medico_suplente}</p>
                                  <p className="text-gray-600">Turno: {s.turno_suplente}</p>
                                </div>
                              </div>
                              {s.notas && (
                                <div className="mt-2 text-sm bg-gray-50 rounded p-2">
                                  <p className="text-gray-600">üìù {s.notas}</p>
                                </div>
                              )}
                            </div>
                          ))}
                        </div>
                      </>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>